%%*******************************************************************************************************************************
\def\baselinestretch{1.66}
%%*******************************************************************************************************************************
%\pagestyle{fancyplain}
%********************************************************************************************************************************
\chapter{无约束多分辨率预测控制器的设计}
%%*******************************************************************************************************************************
\fancyhf{}  %清除以前对页眉页脚的设置
\fancyhead[CE]{\color{black}\xiaowuhao\CJKfamily{kai}吉林大学硕士学位论文} \fancyfoot[LE]{\thepage}    % 在book文件类别下,
\fancyhead[CO]{\color{black}\xiaowuhao\CJKfamily{kai}\leftmark} \fancyfoot[RO]{\thepage}     % \leftmark自动存录各章之章名,
%********************************************************************************************************************************
\setlength{\abovedisplayskip}{2pt plus5pt minus1pt}     %公式前的距离
\setlength{\belowdisplayskip}{2pt plus5pt minus1pt}
%%*******************************************************************************************************************************
上章利用小波变换的多分辨率特性设计出一个类似~PID~控制器的多分辨率PID控制器，但其和传统PID 控制器一样，只是针对单输入单输出系统(SISO)的一种控制算法。但是到了多输入多输出（MIMO）系统中，一般一个输入信号的变化会使多个输出量发生变化，而且每个输出量也不一定只由一个输入量控制，故多输入多输出系统一般内部结构比较复杂，各个变量之间存在耦合，如果想把~PID~控制算法运用到多输入多输出系统中，就需要就系统进行解耦，文\cite{zhang2000MIMOPID}基于神经网络的~PID~ 控制，提出了一种可用于有耦合的多输入多输出系统的比例、积分和微分参数在线自整定的神经网络~PID~解耦控制器，其可以实现对多变量系统的解耦控制，取得很好的控制效果。但在大多数情况下，解耦过程是复杂且繁杂的且解耦后系统模型的精度也会受原系统模型精度的影响，如果解耦模型不够准确，也会影响到最终系统的控制效果~\textsuperscript{\cite{Lixu2003}}，故需要针对多输入多输出系统，需要采用更先进的控制算法。

模型预测控制(Model Predictive Control, MPC)是近几年来被广泛讨论的一种先进控制算法，其可以很好的处理多变量、多输入、多输出系统。图~\ref{fig3:1:MPC}~展示其原理图，MPC~可以根据当前时刻测量的系统信息，然后利用系统的状态方程预测出系统未来时刻的状态和输入等信息，然后根据系统的控制目标在线求解出系统的开环最优控制序列，并将求解出的开环控制序列中的第一个元素应用到系统中以此更新系统的信息；在下一个采样时刻，重复上述过程，用新的测量值刷新优化问题求解新的控制序列，由此往复完成系统的最优控制~\textsuperscript{\cite{nl:chen_h13a}}。当然，预测控制还有一个突出的优点，其能针对实际中系统存在的各种各样的约束进行处理，其在线求解的优化问题就能包含各种不等式和等式约束，然后就可以通过相应的高等数学工具，来处理系统的各种约束，最终得到良好的控制效果。
\begin{figure}[htb]
\centering
\includegraphics[width=12cm]{ch3/MPC.eps}
\caption{预测控制原理图} \label{fig3:1:MPC}
\end{figure}
但是预测控制完全是在时域内考虑系统，针对多采样率系统控制问题和未知噪声或扰动抑制，传统时域预测控制方法还存在局限性，所以需要采取频率分析工具对此类控制系统进行分析和控制。

一般来说，预测控制器对可以测量已知的外部干扰有很好的干扰抑制作用，其在计算系统未来预测状态时可以将已知的外部干扰考虑在内，在计算最优控制序列时就可以对可测干扰进行前馈补偿，这样达到很好的扰动抑制效果。但是当外部噪声为不规则、不可测量时，如测量噪声，执行器噪声等，预测控制通过反馈校正的方式进行抑制时，模型的预测输出可能偏离被控对象的真实输出，产生误差，如果不及时利用系统的实时信息进行校正，这样在下一步滚动优化过程就会受到误差的影响，最终控制器就对这些随机噪声的抑制效果越来越差。为了提高预测控制的扰动抑制性能，不少学者提出了不同的改进方法，文\cite{Morari1991Model}提出了一种斜坡扰动模型以提高控制器对一类输入扰动的抑制性能，文\cite{haseltine2005critical}利用卡尔曼滤波器在线估计出不可测干扰的大小，用于利用到无约束线性系统中，并最终结合~MPC~算法，从而提高控制器的抗扰性能。这些方式都是基于时域内的信号信息，其目的就是尽量找到对扰动信号的准确预测方法然后再加以处理，但是其方法相对较为复杂且需要针对特定的扰动系统才能发挥最好的效果。而如果从信号频域角度进行干扰抑制，基于傅里叶变换的去噪方法存在着保护信号局部性和抑制噪声之间的矛盾，小波分析由于具有良好的时频局部化的性质，从而为控制系统中信号去噪抗扰提供了一个有力的工具。

另一方面，由于预测控制本身是基于系统时序信息进行控制的，而在有些情况下，需要对系统在不同分辨率层次上有着不同的控制需求，如在交通控制中，需要对整体车流量和某个街道车流量的控制，在医学图像显示控制中，需要得到不同分辨率下图像的信息等，而目前比较火的虚拟现实(virtual reality,VR)技术，也是一个多分辨率展示和控制的典型范例。而针对不同输入输出频率的系统，也会采用多分辨率控制思想，文献\cite{shi2011}提出了针对有源电力滤波器的多分辨率控制算法，将控制任务分为高频和低频的控制策略，文献\cite{sun2012} 提出一种高速列车主动悬挂多速率控制方法，其通过对主动悬挂系统内不同变量拥有不同的采样时间关系进行多速率建模，然后针对多速率系统设计最优控制算法，最终获得良好的控制效果。而小波的多分辨率分析特性正好能应用到系统中，通过小波多分辨率分析，能得到系统更多的信息，这样就能跟深入的了解系统特征，并根据相应的控制目标做出对应的控制操作。

本章首先考虑无约束预测控制与小波多分辨率分析工具相结合，设计出多分辨率预测控制器。

%***********************************************************************************************************************************
\section{无约束模型预测控制基本原理}
%***********************************************************************************************************************************
预测控制的基本原理就包含三个步骤：预测系统未来动态，求解优化问题，计算出来的解的第一个元素作用于系统；然后进行滚动时域、重复进行的机制。故可以按照此思路推导出基于线性状态空间模型预测控制的基本原理~\textsuperscript{\cite{nl:chen_h13a}}。

考虑线性离散时间系统的状态空间模型如下：
\equ{\label{equ3:1:model}
\begin{array}{l}
x(k + 1) = Ax(k) + Bu(k)\\
y(k) = Cx(k)
\end{array}
}
其中~$x(k) \in {\mathbb{R}^{{n_x}}}$~是系统状态变量；$u(k) \in {\mathbb{R}^{{n_u}}}$是控制输入变量；$y(k) \in {\mathbb{R}^{{n_c}}}$是被控输入变量，为了减少或消除系统的静态误差一般情况下引入积分计算，可以将模型（\ref{equ3:1:model}）改成如下增量模型
\equ{\label{equ3:2:dmodel}
\begin{array}{l}
\Delta x(k + 1) = A\Delta x(k) + B\Delta u(k)\\
y(k) = C\Delta x(k) + y(k - 1)
\end{array}
  }
其中
\[\begin{array}{l}
\Delta x(k) = x(k) - x(k - 1),\\
\Delta u(k) = u(k) - u(k - 1).
\end{array}\]
根据预测控制的基本原理，首先以最新测量值为初始条件，基于增量模型（\ref{equ3:2:dmodel}）预测系统未来动态。设定预测时域为~$p$~，控制时域为~$m$~，且满足 ~$m \le p$。假设在控制时域之外，控制量不变，对此可以推导出系统未来~$p$~步的预测输出方程为：
\equ{\label{equ3:3:predictive_model}
{Y_p}(k + 1|k) = {S_x}\Delta x(k) + \tau y(k) + {S_u}\Delta U(k)
}
其中
\[{S_x} = \left[ {\begin{array}{*{20}{c}}
{CA}\\
{\sum\limits_{i = 1}^2 {C{A^i}} }\\
{...}\\
{\sum\limits_{i = 1}^p {C{A^i}} }
\end{array}} \right],{S_u} = \left[ {\begin{array}{*{20}{c}}
{CB}&0&{...}&0\\
{\sum\limits_{i = 1}^2 {C{A^{i - 1}}B} }&{CB}&{...}&0\\
{...}&{...}&{...}&{...}\\
{\sum\limits_{i = 1}^p {C{A^{i - 1}}B} }&{C{A^{i - 2}}B}&{....}&{\sum\limits_{i = 1}^{p - m + 1} {C{A^{i - 1}}B} }
\end{array}} \right],\tau  = {\left[ \begin{array}{l}
{I_{nc \times nc}}\\
{I_{nc \times nc}}\\
....\\
{I_{nc \times nc}}
\end{array} \right]_{p \times 1}}\]
然后根据系统的控制目标需求得到系统的开环优化问题，结合系统输出的预测方程就可以求解出系统的最优控制序列，一般对于跟踪控制问题，我们的基础目标是系统能既快又稳定的跟踪上系统的参考输入，经常地，我们还希望控制动作变化不要太大，故无约束预测控制开环优化问题一般可以描述为如下形式：
\equ{\label{equ3:4:OJ}
 \mathop {\min }\limits_{\Delta U(k)} J = ||{\Gamma _y}({Y_p}(k + 1|k) - R(k + i))|{|^2} + ||{\Gamma _u}\Delta U(k)|{|^2}
 }
对于上述优化问题，由于预测模型是线性的，目标函数是二次型的，故可以通过离线求导运算得到系统在~$k$~时刻的最优控制序列的解析解为
\equ{\label{equ3:5:optimal_u}
  \Delta {U^ * }(k) = {({S_u}^T{\Gamma _y}^T{\Gamma _y}{S_u} + {\Gamma _u}^T{\Gamma _u})^{ - 1}}{S_u}^T{\Gamma _y}^T{\Gamma _y}{E_p}(k + 1|k)
  }
其中
\equ{\label{equ3:9:EP}
{E_p}(k + 1|k) = R(k + 1) - {S_x}\Delta x(k) - \tau y(k)
}
根据前文提到的模型预测控制基本原理，将求解出来的最优控制序列中的第一个元素作用于被控系统进行控制，即
\equ{\label{equ3:6:optimal_u1}
\begin{array}{l}
\Delta u(k) = {[{I_{nu \times nu}}\;\;0\;\;...\;\;0]_{1 \times m}}\Delta {U^ * }(k)\\
\;\;\;\;\;\;\;\;\;\; = {[{I_{nu \times nu}}\;\;0\;\;...\;\;0]_{1 \times m}}{({S_u}^T{\Gamma _y}^T{\Gamma _y}{S_u} + {\Gamma _u}^T{\Gamma _u})^{ - 1}}{S_u}^T{\Gamma _y}^T{\Gamma _y}{E_p}(k + 1|k)
\end{array}
}
定义预测控制增益
\equ{\label{equ3:7:gain}
{K_{mpc}} = {[{I_{nu \times nu}}\;\;0\;\;...\;\;0]_{1 \times m}}{({S_u}^T{\Gamma _y}^T{\Gamma _y}{S_u} + {\Gamma _u}^T{\Gamma _u})^{ - 1}}{S_u}^T{\Gamma _y}^T{\Gamma _y}
}
因此，预测控制的最优控制增量可以记为
  \equ{\label{equ3:8:optimal_u2}
  \Delta u(k) = {K_{mpc}}{E_p}(k + 1|k)
  }
通过上式可以看出~${E_p}(k + 1|k)$~ 具有反馈结构，其可以看作是系统的反馈偏差矩阵，而 ~${K_{mpc}}$~可以看作是对系统偏差信号的增益调节，而且通过~${K_{mpc}}$~的式子可以发现，其只与加权矩阵~${\Gamma _y}$~ 和~${\Gamma _u}$~ 有关，与系统状态无关，当~${\Gamma _y}$~ 和~${\Gamma _u}$~固定时，其就可以通过离线计算得出，故线性无约束预测控制的也属于一种增益控制，我们可以将其看作是一个“高级PID”算法，可以将小波滤波和多分辨率分析应用其中。
%***********************************************************************************************************************************
\section{基于小波分析的预测控制器}
%***********************************************************************************************************************************

通过上节中无约束线性预测控制的相关公式，然后结合小波去噪和小波多分辨率的特性完成基于小波分析的预测控制器的设计。
%***********************************************************************************************************************************
\subsection{小波去噪}
%***********************************************************************************************************************************
小波去噪方法之所以取得成功主要是因为小波系统的稀疏分布，使得信号变换后的熵降低，然后其多分辨率分析的特性，使其能够对信号进行特征提取和保护，再者就是小波变换可以对信号去相关，这样混入信号中的噪声经过变换后有白化的趋势，所以在小波域比在时域更有利于去噪，最后小波变换十分丰富，不同小波函数的选择，不同去噪方法的选择都能使其适用于到各种场合。

一般来说，一个含噪声的一维信号的模型可以表示成如下形式，即
\[S(t) = f(t) + \alpha  \cdot e(t)\;\;\;t = 0,1, \cdots n - 1\]
其中 ~$f(t)$~ 为真实信号，   ~$e(t)$~ 为噪声， ~$S(t)$~ 为含噪声的信号。在实际的工程应用中，如上节~MPC~控制算法中，一般有用信号通常表现为中低频信号，而噪声信号通常表现为高频信号，故可以利用这个特点进行小波去噪。一般情况下一维信号的消噪过程可按照如图\ref{fig3:2:wavedenoise}所示的流程来进行~\textsuperscript{\cite{liutao2006}}。
\begin{figure}[htb]
\centering
\includegraphics[width=15cm]{ch3/wave_denoise.eps}
\caption{小波去噪流程} \label{fig3:2:wavedenoise}
\end{figure}
故一维信号利用小波进行降噪由以下步骤组成：

（1）对含噪信号进行预处理，便于后续处理；

（2）一维信号的小波分解。选择一个小波并确定一个分解层次N，然后对信号进行N层分解；

（3）小波分解高频系数的阈值量化。对第一层到第N层的每一层高频系数进行软阈值或硬阈值量化处理；

（4）一维小波的重构。根据小波分解的第N层的系数和经过量化处理后的第一层到第N层的高频系数，进行一维信号的重构。

故可以根据此过程结合线性无约束~MPC~算法，先对~MPC~的输入信号进行滤波，MPC~的输入信号为参考跟踪信号~$r$，系统输出~$y$~和系统状态量增量~$\Delta x$~ ，这些变量都有可能包含着噪声。首先需要对这些输入信号进行预处理，由于输入的是实时信号，故此处的预处理即为对信号进行缓存，和上一章相同，为了削弱小波变换中的边界效应，故在此可以沿用上章的对称缓存数据窗的结构，将输入数据进行先入先出方式进行数据缓存，这样信号就完成了预处理操作。接着就是对输入信号进行一维信号的小波分解，需要选择分解层次和小波类型，此处和上章选择的原则一样，从运算量和分解效果出发选择合适的小波基、分解长度和分解层次。然后就是到了去噪过程中关键的小波分解高频系数的阈值选取和阈值量化问题，从某种程度上来说，它直接关系到信号消噪的质量，一般来说有通用阈值法\textsuperscript{\cite{donoho1995noising}}，极小化风险阈值法\textsuperscript{\cite{donoho1995adapting}}、假设检验法\textsuperscript{\cite{abramovich1995thresholding}}等等。一般来说，通用阈值法的计算量小，但其滤波的效果差，而其他方法滤波效果相对要好，但是计算量大，不适合于在线滤波。而阈值量化就体现了对小波系数的不同处理策略，常用的有软阈值和硬阈值等消噪方法。他们的基本思想都是对经小波分解后的各层小波系数中的值与设定的阈值作比较，当小波系数小于阈值时，将系数置零，大于阈值时，小波系数不变。一般来说，硬阈值能很好的保留信号的局部特性，但处理后的信号经常会出现振荡现象，即伪~Gibbs~现象，而软阈值处理后的信号较为平滑，但也可能会造成信号边缘失真，为了克服两者的缺点，后来人们提出了很多改进算法，能提高滤波效果的同时，但是也增大的计算量，这在实时控制系统中是不可取的，由于本次经过滤波后的信号是用于对系统进行未来状态预测，平滑的信号能使系统的预测方程更准确也易处理，故本次的采用的 阈值选择为软阈值函数，然后根据不同分解层次选择不同的阈值，这样能获得更好的滤波去噪效果。在完成各层小波系数经过阈值处理后，就到了小波去噪的最后一步，将各层的小波系数按照分解的方式进行逆向重构，即得到经过滤波后的信号序列，然后按照输入数据的结构从序列中提取出代表当前时刻的数据即为滤波后的数据，具体滤波过程如图~\ref{fig3:3:wavelet_denoise}~所示。
\begin{figure}[htb]
\centering
\includegraphics[width=15cm]{ch3/wavelet_denoise.eps}
\caption{小波去噪过程} \label{fig3:3:wavelet_denoise}
\end{figure}
%***********************************************************************************************************************************
\subsection{多分辨率分析}
%***********************************************************************************************************************************
在完成小波去噪滤波后，就可以得到控制器在当前时刻的输入信号 $\bar r，\Delta \bar x，\bar y$，这样就可以对多输入多输出系统进行未来状态预测，此时系统的预测方程~$\overline {{Y_p}} (k + 1|k)$ ~ 不包含外界噪声，这样控制器的输出会更加准确，然后通过式（\ref{equ3:9:EP}）可以得到系统的反馈偏差矩阵~$\overline {{E_p}} (k + 1|k)$ ，假设系统的预测时域长度为~P，系统的输出量个数为~$N_y$~，则此偏差矩阵的长度为~$P*N_y$~，其中每个输出变量的长度为~$P$~，这样可以分别对不同输出变量进行小波分解，这样就能得到不同分辨率输出变量的中间值，类似多分辨率~PID~ 控制计算算法，经过单向重构后，就可以得到原始信号在不同分辨率下的表示值。

在得到系统的反馈偏差序列~$\overline {{E_p}} (k + 1|k)$在不同分辨率的分解信息后，就可以根据系统在不同分辨率上的要求，在不同分辨率上调节加权矩阵~${\Gamma _y}\_i$~ 和~${\Gamma _u}\_i$~ 得到不同分辨率上的~${K_{mpc}}\_H,{K_{mpc}}\_m1,...{K_{mpc}}\_L$~ ，故根据式（\ref{equ3:8:optimal_u2}）就可以计算出不同分辨率上的最优控制序列
\equ{\label{equ3:10:MR_dU}
\overline {\Delta u} \_i = {K_{mpc}}\_i \cdot \overline {{E_p}} \_i\;\;\;i = 1,2 \cdots N
}
这样即可得到不同分辨率控制序列~$\overline {\Delta u} \_H,\overline {\Delta u} \_m1, \cdots ,\overline {\Delta u} \_L$。此时分析这些控制序列，这些控制序列分别代表着系统对不同频率信号的最优响应输入，故可以根据系统要求的频率响应选择响应分辨率控制序列进行输出。考虑到整体的系统响应输出，根据小波分解的特性，将这些最优控制序列进行加和得到最终系统最优的控制序列
\equ{\label{equ3:11:U}
\Delta u(k) = \overline {\Delta u} \_H + \overline {\Delta u} \_m1 +  \cdots  + \overline {\Delta u} \_L
}
此算法的特点主要在于可以针对不同分辨率的信息进行不同的加权，如果控制系统比较注重高频响应特性，这样相对应的高频分解信号的加权因数~${\Gamma _y}$~和${\Gamma _u}$就设定大些，如果控制系统比较注重系统的低频响应特性，这样就需要增加相对应的低频分解信号的加权因数，因此达到系统对不同分辨率特性的控制需求。

可以看出在算法设计中，需要对未来状态进行小波分解，不同于多分辨率PID控制器的信号的小波分解需要将输入信号进行数据窗缓存，多分辨率~MPC~控制算法中待分解的信号为系统未来的预测信号，其中信号的长度就是预测时域的长度。故多分辨率PID控制算法是根据系统“过去时刻”的信息完成控制输出量的计算，而多分辨率MPC是根据系统的未来状态的信息完成控制器输出量的计算，突出了“预测”的特性，这是两者最根本的区别。具体多分辨率MPC控制器的设计过程和多分辨率PID控制器相似，控制时域的长度、分解的层次和小波类型都会决定了控制器的控制效果和运行速度，根据上章的相关分析，一般来说多分辨率MPC控制器的小波分解层次为3，预测时域选择为16，小波类型选择为db2 小波。
%***********************************************************************************************************************************
\subsection{基于小波变换的多分辨率MPC算法}
%***********************************************************************************************************************************
综上分析可得，具体的多分辨率~MPC~控制器的设计结构图如图\ref{fig3:4:MRMPC}所示。此次设计的预测控制器结合小波滤波和多分辨率分析特性，先将控制器输入信号，参考输入~$r$~，被控对象状态反馈增量 ~$\Delta x$~和输出反馈量~$y$~ 分别进行小波多分辨率分解，然后针对不同分辨率的信号进行阈值滤波后得到实时的滤波信号 ~$\bar r,\Delta \bar x,\bar y$，然后针对滤波信号结合预测时域~$p$~ 对系统的未来状态进行预测，从而计算得到系统的偏差信号矩阵~$\overline {{E_p}} (k + 1|k)$ ，将偏差信号矩阵 进行小波分析得到其在各个分辨率上的偏差信息~$\overline {{E_p}} {\__H},\overline {{E_p}} {\__{m1}}, \cdots ,\overline {{E_p}} {\__L}$~，这样根据实际系统对不同分辨率上不同的控制要求，设计出不同的加权系数，得到不同分辨率上的控制增益~${K_{mpc}}\_H,{K_{mpc}}\_m1,...{K_{mpc}}\_L$~ ，这样就得到不同分辨率的控制序列~$\Delta u(k)\_H,\Delta u(k)\_m1, \cdots ,\Delta u(k)\_L$~ ，根据小波变换理论，最终的控制序列就为各分辨率的控制序列之和。可以看出，多分辨率~MPC~控制器通过被控对象的过去状态的信息和未来状态信息进行控制，由于其信息内容十分丰富，故能得到很好的控制效果。
\begin{figure}[htb]
\centering
\includegraphics[width=15cm]{ch3/MRMPC.eps}
\caption{多分辨率预测控制器总体框图} \label{fig3:4:MRMPC}
\end{figure}
%***********************************************************************************************************************************
\section{本章小结}
%***********************************************************************************************************************************
本章结合无约束线性预测控制和小波多分辨率分析完成无约束多分辨率预测控制器的设计，该控制器主要是利用预测控制能处理多输入多输出系统的特性，扩充上章的基于小波分析的多分辨率控制器的应用范围，使其能应用到多输入多输出系统的滤波控制中，然后利用预测控制的预测特性，针对系统的未来状态进行多分辨率分解，从而得到一个多分辨率控制器，故该控制器能够通过针对实际多目标控制系统做出不同的加权，实现不同分辨率控制的控制器，故该控制器具有很高的灵活性和去噪能力，为未来应用到频域系统打好基础。

\newpage
\thispagestyle{empty}
\cleardoublepage
